---
title: "data manipulation 1  тренировочные упражнения 2"
author: "Ilya Kochergin"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Импорт данных для заданий


```{r}
library(readr)
```



```{r,message=FALSE}
city_t <- read_csv2("csv/city.txt")
country_t <- read_csv2("csv/country.txt")
language_t <- read_csv2("csv/countrylanguage.txt")
```

```{r}
country_t
```

```{r}
language_t
```


Шпаргалка по пакету находится в [разделе шпаргалок RStudio](https://rstudio.com/resources/cheatsheets/) под именем **Data Transformation Cheatsheet**

```{r,message=F}
library(dplyr)
```

Фреймы данных получаются усовершенствованные (tibble), которые поддерживает пакет dplyr.



## Загруженные таблицы

База world

```{r}
city_t
country_t
```

## Практические задания


**Задание 0**

Сколько на каждом континенте стран и территорий

```{r}
country_t %>%  group_by(Continent)  %>% summarise(kolvo_stran=n()) %>% arrange(desc(kolvo_stran))
```

**Задание 001**
Соединить города и страны по CountryCode,  выдать 10 самых населенных

```{r}
city_t %>% inner_join(country_t, by="CountryCode",suffix=c("_city","_country")) %>% arrange(desc(Population_city)) %>% slice_head(n=10)
```

```{r}
marks <- c(one=1,two=2,three=3,four=4, five=5,n_ya=0)
marks["two"]
marks[6]
```


**Задание 002**
Соединить города и страны по Capital,  выдать 10 самых населенных

```{r}
city_t %>% inner_join(country_t, by=c(CityID="Capital"),suffix=c("_city","_country")) %>% slice(1:10) 
```



**Задание 1**
Выдайте названия территорий и стран мира, в которых нет крупных городов (нет соответствующих строк в таблице city_t)


**Задание 2**
Выдать названия регионов Европы, где есть города с населением более 7 миллионов и укажите количество таких городов.


**Задание 3**
Выдайте  те же регионы, что и в запросе из предыдущей задачи, но выдайте 
только названия этих регионов, не выдавая количества городов.
Сделайте это при помощи функции semi_join()  



**Задание 4**
Узнайте, у каких стран и территорий не указан год независимости. Выдайте только территории, c названиями начинающиеся с латинской буквы "A" и с населением более тысячи.  Столбцы: Name, Continent, Population. Подсказки:  в функции grepl   шаблон (pattern) строится по правилам [регулярных выражений](https://ru.wikipedia.org/wiki/Регулярные_выражения).  Есть [целый сайт](http://www.regular-expressions.info/rlanguage.html) про них. Если шаблон начинается с "^"", то он сопоставляется (match) только с началом строки. А символ "$" означает в шаблоне конец строки.   

Функция is.na() позволяет находить пустые значения (NA).


**Задание 5**
Выдайте 5 регионов мира с наименьшим количеством столиц. Для того, чтобы не выводились регионы совсем без столиц примените inner_join(). 



**Задание 6**
(модификация предыдущей задачи)

Выдайте 5 регионов мира с наименьшим количеством столиц. Для того, чтобы выводились регионы с нулевым количеством столиц примените  другой тип join. Подсказка: "Хакерская" замена sql-ной функции count: sum(логичесткое выражение) -- будет интерпретировать TRUE как 1, а FALSE как 0, то есть подсчитает, сколько раз было выполнено условие. Вы можете подсчитать сколько с регионом связано столиц, исключая из подсчета те строки, которые получились в результате outer join  и содержат пустые значения (NA) в тех полях, где в нормальных условиях NA не могут появиться. 




